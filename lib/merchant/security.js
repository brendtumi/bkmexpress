"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var buffer_1 = require("buffer");
var crypto = require("crypto");
var semver = require("semver");
var vposConfig_1 = require("./request/vposConfig");
var nodeVersion = semver.clean(process.version);
var exceptions_1 = require("../exceptions");
var EncryptionUtil = (function () {
    function EncryptionUtil() {
    }
    EncryptionUtil.sign = function (privateKey, data) {
        try {
            var sign = crypto.createSign("RSA-SHA256");
            sign.update(data);
            return sign.sign(privateKey, "base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.encryptWithBex = function (vposConfig) {
        if (vposConfig instanceof vposConfig_1.VposConfig) {
            return EncryptionUtil.encrypt(EncryptionUtil.publicKey, JSON.stringify(vposConfig));
        }
        else {
            return EncryptionUtil.encrypt(EncryptionUtil.publicKey, vposConfig);
        }
    };
    EncryptionUtil.encrypt = function (publicKey, plaintext) {
        try {
            var cipher = crypto.createCipher("RSA", publicKey);
            cipher.update(plaintext, "utf8");
            return cipher.final("base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.decrypt = function (privateKey, plaintext) {
        try {
            var decipher = crypto.createDecipher("RSA", privateKey);
            decipher.update(plaintext, "base64");
            return decipher.final("utf8");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.verifyBexSign = function (data, signature) {
        try {
            var verify = crypto.createVerify("RSA-SHA256");
            verify.update(data);
            verify.verify(EncryptionUtil.publicKey, signature, "base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
        return false;
    };
    EncryptionUtil.encode64 = function (data) {
        if (semver.gt(nodeVersion, "6.0.0")) {
            return buffer_1.Buffer.from(data).toString("base64");
        }
        else {
            return new buffer_1.Buffer(data).toString("base64");
        }
    };
    EncryptionUtil.decode64 = function (data) {
        if (semver.gt(nodeVersion, "6.0.0")) {
            return buffer_1.Buffer.from(data, "base64").toString();
        }
        else {
            return new buffer_1.Buffer(data, "base64").toString();
        }
    };
    return EncryptionUtil;
}());
EncryptionUtil.publicKey = "-----BEGIN PUBLIC KEY-----\n" +
    "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuZj/TQ9ZRY5KnsA3HMPq\n" +
    "bNwI32J+Bisyv7KX7IRJh5rN5LW3g7t6pulArLIEU3sn28ZQEQ+GCb9yvk6zIUoq\n" +
    "KBqH0H+gvxOtsklOUkFRgh+/FghNDoe0OzkXTLjQKhh6MRMBR9l3cws9nA2cu+M5\n" +
    "kw67F8j0+4SogHJ+VS1wA2kfWx58PNDIg9DtAVwmD1JbjAziPONv0wHSa8oNgia9\n" +
    "Tx6ia6FS4nfjRNqpVqI0m2jIcG8yXt1OaBSazkuRlRepMtDVwMGF4xOWXuRVv+G5\n" +
    "oiTsbOez9tQAcx+KH0W1Pn9Q9/zzOJyF9AS8J1UDE7c7rKwXGDnuTBU1BwdAGyB8\n" +
    "7QIDAQAB\n" +
    "-----END PUBLIC KEY-----";
exports.EncryptionUtil = EncryptionUtil;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VjdXJpdHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWVyY2hhbnQvc2VjdXJpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFPQSxpQ0FBOEI7QUFDOUIsK0JBQWlDO0FBQ2pDLCtCQUFpQztBQUNqQyxtREFBZ0Q7QUFDaEQsSUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbEQsNENBQWtEO0FBRWxEO0lBQUE7SUFvRkEsQ0FBQztJQWxGaUIsbUJBQUksR0FBbEIsVUFBbUIsVUFBa0IsRUFBRSxJQUFZO1FBQy9DLElBQUksQ0FBQztZQUNELElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDM0MsQ0FBQztRQUNELEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDWCxNQUFNLElBQUksZ0NBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekMsQ0FBQztJQUNMLENBQUM7SUFFYSw2QkFBYyxHQUE1QixVQUE2QixVQUErQjtRQUN4RCxFQUFFLENBQUMsQ0FBQyxVQUFVLFlBQVksdUJBQVUsQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDeEYsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDO1lBQ0YsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN4RSxDQUFDO0lBQ0wsQ0FBQztJ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bkZ0Qix3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGF1dGhvciAgVMO8bWF5IMOHZWJlciA8dHVtYXljZWJlckBnbWFpbC5jb20+XG4gKiBAbGluayAgICBodHRwczovL2dpdGh1Yi5jb20vYnJlbmR0dW1pL2JrbWV4cHJlc3NcbiAqIEBsaWNlbnNlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqIEBkYXRlIDI2LjA0LjIwMTdcbiAqL1xuXG5pbXBvcnQge0J1ZmZlcn0gZnJvbSBcImJ1ZmZlclwiO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCAqIGFzIHNlbXZlciBmcm9tIFwic2VtdmVyXCI7XG5pbXBvcnQge1Zwb3NDb25maWd9IGZyb20gXCIuL3JlcXVlc3QvdnBvc0NvbmZpZ1wiO1xuY29uc3Qgbm9kZVZlcnNpb24gPSBzZW12ZXIuY2xlYW4ocHJvY2Vzcy52ZXJzaW9uKTtcbmltcG9ydCB7RW5jcnlwdGlvbkV4Y2VwdGlvbn0gZnJvbSBcIi4uL2V4Y2VwdGlvbnNcIjtcblxuZXhwb3J0IGNsYXNzIEVuY3J5cHRpb25VdGlsIHtcblxuICAgIHB1YmxpYyBzdGF0aWMgc2lnbihwcml2YXRlS2V5OiBzdHJpbmcsIGRhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzaWduID0gY3J5cHRvLmNyZWF0ZVNpZ24oXCJSU0EtU0hBMjU2XCIpO1xuICAgICAgICAgICAgc2lnbi51cGRhdGUoZGF0YSk7XG4gICAgICAgICAgICByZXR1cm4gc2lnbi5zaWduKHByaXZhdGVLZXksIFwiYmFzZTY0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVuY3J5cHRpb25FeGNlcHRpb24oZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBlbmNyeXB0V2l0aEJleCh2cG9zQ29uZmlnOiBWcG9zQ29uZmlnIHwgc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHZwb3NDb25maWcgaW5zdGFuY2VvZiBWcG9zQ29uZmlnKSB7XG4gICAgICAgICAgICByZXR1cm4gRW5jcnlwdGlvblV0aWwuZW5jcnlwdChFbmNyeXB0aW9uVXRpbC5wdWJsaWNLZXksIEpTT04uc3RyaW5naWZ5KHZwb3NDb25maWcpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBFbmNyeXB0aW9uVXRpbC5lbmNyeXB0KEVuY3J5cHRpb25VdGlsLnB1YmxpY0tleSwgdnBvc0NvbmZpZyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGVuY3J5cHQocHVibGljS2V5OiBzdHJpbmcsIHBsYWludGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXIoXCJSU0FcIiwgcHVibGljS2V5KTtcbiAgICAgICAgICAgIGNpcGhlci51cGRhdGUocGxhaW50ZXh0LCBcInV0ZjhcIik7XG4gICAgICAgICAgICByZXR1cm4gY2lwaGVyLmZpbmFsKFwiYmFzZTY0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVuY3J5cHRpb25FeGNlcHRpb24oZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBkZWNyeXB0KHByaXZhdGVLZXk6IHN0cmluZywgcGxhaW50ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZGVjaXBoZXIgPSBjcnlwdG8uY3JlYXRlRGVjaXBoZXIoXCJSU0FcIiwgcHJpdmF0ZUtleSk7XG4gICAgICAgICAgICBkZWNpcGhlci51cGRhdGUocGxhaW50ZXh0LCBcImJhc2U2NFwiKTtcbiAgICAgICAgICAgIHJldHVybiBkZWNpcGhlci5maW5hbChcInV0ZjhcIik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRW5jcnlwdGlvbkV4Y2VwdGlvbihlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHZlcmlmeUJleFNpZ24oZGF0YTogc3RyaW5nLCBzaWduYXR1cmU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdmVyaWZ5ID0gY3J5cHRvLmNyZWF0ZVZlcmlmeShcIlJTQS1TSEEyNTZcIik7XG4gICAgICAgICAgICB2ZXJpZnkudXBkYXRlKGRhdGEpO1xuICAgICAgICAgICAgdmVyaWZ5LnZlcmlmeShFbmNyeXB0aW9uVXRpbC5wdWJsaWNLZXksIHNpZ25hdHVyZSwgXCJiYXNlNjRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRW5jcnlwdGlvbkV4Y2VwdGlvbihlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZW5jb2RlNjQoZGF0YTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHNlbXZlci5ndChub2RlVmVyc2lvbiwgXCI2LjAuMFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGRhdGEpLnRvU3RyaW5nKFwiYmFzZTY0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXIoZGF0YSkudG9TdHJpbmcoXCJiYXNlNjRcIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRlY29kZTY0KGRhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGlmIChzZW12ZXIuZ3Qobm9kZVZlcnNpb24sIFwiNi4wLjBcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBCdWZmZXIuZnJvbShkYXRhLCBcImJhc2U2NFwiKS50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXIoZGF0YSwgXCJiYXNlNjRcIikudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHB1YmxpY0tleSA9XG4gICAgICAgIFwiLS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS1cXG5cIiArXG4gICAgICAgIFwiTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF1WmovVFE5WlJZNUtuc0EzSE1QcVxcblwiICtcbiAgICAgICAgXCJiTndJMzJKK0Jpc3l2N0tYN0lSSmg1ck41TFczZzd0NnB1bEFyTElFVTNzbjI4WlFFUStHQ2I5eXZrNnpJVW9xXFxuXCIgK1xuICAgICAgICBcIktCcUgwSCtndnhPdHNrbE9Va0ZSZ2grL0ZnaE5Eb2UwT3prWFRMalFLaGg2TVJNQlI5bDNjd3M5bkEyY3UrTTVcXG5cIiArXG4gICAgICAgIFwia3c2N0Y4ajArNFNvZ0hKK1ZTMXdBMmtmV3g1OFBORElnOUR0QVZ3bUQxSmJqQXppUE9OdjB3SFNhOG9OZ2lhOVxcblwiICtcbiAgICAgICAgXCJUeDZpYTZGUzRuZmpSTnFwVnFJMG0yakljRzh5WHQxT2FCU2F6a3VSbFJlcE10RFZ3TUdGNHhPV1h1UlZ2K0c1XFxuXCIgK1xuICAgICAgICBcIm9pVHNiT2V6OXRRQWN4K0tIMFcxUG45UTkvenpPSnlGOUFTOEoxVURFN2M3ckt3WEdEbnVUQlUxQndkQUd5QjhcXG5cIiArXG4gICAgICAgIFwiN1FJREFRQUJcXG5cIiArXG4gICAgICAgIFwiLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tXCI7XG59Il19