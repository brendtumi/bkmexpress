"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var buffer_1 = require("buffer");
var crypto = require("crypto");
var semver = require("semver");
var vposConfig_1 = require("./request/vposConfig");
var nodeVersion = semver.clean(process.version);
var exceptions_1 = require("../exceptions");
var EncryptionUtil = (function () {
    function EncryptionUtil() {
    }
    EncryptionUtil.sign = function (privateKey, data) {
        try {
            var sign = crypto.createSign("RSA-SHA256");
            sign.update(data);
            return sign.sign(privateKey, "base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.verify = function (publicKey, data, signature) {
        try {
            var verify = crypto.createVerify("RSA-SHA256");
            verify.update(data);
            return verify.verify(publicKey, signature, "base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.encrypt = function (publicKey, plaintext) {
        try {
            var plainBuffer = EncryptionUtil.bufferFromString(plaintext);
            var crypt = void 0;
            if (semver.gte(nodeVersion, "0.11.14")) {
                crypt = crypto.publicEncrypt(publicKey, plainBuffer);
            }
            else {
                var NodeRSA = require("node-rsa");
                var key = new NodeRSA(publicKey);
                crypt = key.encrypt(plainBuffer);
            }
            return crypt.toString("base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.decrypt = function (privateKey, plaintext, isBase64) {
        if (isBase64 === void 0) { isBase64 = false; }
        try {
            var plainBuffer = EncryptionUtil.bufferFromString(plaintext, isBase64 ? "base64" : "utf8");
            var crypt = void 0;
            if (semver.gte(nodeVersion, "0.11.14")) {
                crypt = crypto.privateDecrypt(privateKey, plainBuffer);
            }
            else {
                var NodeRSA = require("node-rsa");
                var key = new NodeRSA(privateKey);
                crypt = key.decrypt(plainBuffer);
            }
            return crypt.toString();
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.verifyBexSign = function (data, signature) {
        return EncryptionUtil.verify(EncryptionUtil.publicKey, data, signature);
    };
    EncryptionUtil.encryptWithBex = function (vposConfig) {
        if (vposConfig instanceof vposConfig_1.VposConfig) {
            return EncryptionUtil.encrypt(EncryptionUtil.publicKey, JSON.stringify(vposConfig));
        }
        else {
            return EncryptionUtil.encrypt(EncryptionUtil.publicKey, vposConfig);
        }
    };
    EncryptionUtil.encode64 = function (data) {
        return EncryptionUtil.bufferFromString(data).toString("base64");
    };
    EncryptionUtil.decode64 = function (data) {
        return EncryptionUtil.bufferFromString(data, "base64").toString();
    };
    EncryptionUtil.bufferFromString = function (data, encoding) {
        if (encoding === void 0) { encoding = "utf8"; }
        if (semver.gte(nodeVersion, "6.0.0")) {
            return buffer_1.Buffer.from(data, encoding);
        }
        else {
            return new buffer_1.Buffer(data, encoding);
        }
    };
    return EncryptionUtil;
}());
EncryptionUtil.publicKey = "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuZj/TQ9ZRY5KnsA3HMPq\nbNwI32J+Bisyv7KX7IRJh5rN5LW3g7t6pulArLIEU3sn28ZQEQ+GCb9yvk6zIUoq\nKBqH0H+gvxOtsklOUkFRgh+/FghNDoe0OzkXTLjQKhh6MRMBR9l3cws9nA2cu+M5\nkw67F8j0+4SogHJ+VS1wA2kfWx58PNDIg9DtAVwmD1JbjAziPONv0wHSa8oNgia9\nTx6ia6FS4nfjRNqpVqI0m2jIcG8yXt1OaBSazkuRlRepMtDVwMGF4xOWXuRVv+G5\noiTsbOez9tQAcx+KH0W1Pn9Q9/zzOJyF9AS8J1UDE7c7rKwXGDnuTBU1BwdAGyB8\n7QIDAQAB\n-----END PUBLIC KEY-----";
exports.EncryptionUtil = EncryptionUtil;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VjdXJpdHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWVyY2hhbnQvc2VjdXJpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFPQSxpQ0FBOEI7QUFDOUIsK0JBQWlDO0FBQ2pDLCtCQUFpQztBQUNqQyxtREFBZ0Q7QUFDaEQsSUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbEQsNENBQWtEO0FBRWxEO0lBQUE7SUF1R0EsQ0FBQztJQXJHaUIsbUJBQUksR0FBbEIsVUFBbUIsVUFBa0IsRUFBRSxJQUFZO1FBQy9DLElBQUksQ0FBQztZQUNELElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDM0MsQ0FBQztRQUNELEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDWCxNQUFNLElBQUksZ0NBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekMsQ0FBQztJQUNMLENBQUM7SUFFYSxxQkFBTSxHQUFwQixVQUFxQixTQUFpQixFQUFFLElBQVksRUFBRSxTQUFpQjtRQUNuRSxJQUFJLENBQUM7WUFDRCxJQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN6RCxDQUFDO1FBQ0QsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNYLE1BQU0sSUFBSSxn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RWEsdUJBQVEsR0FBdEIsVUFBdUIsSUFBWTtRQUMvQixNQUFNLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRWEsdUJBQVEsR0FBdEIsVUFBdUIsSUFBWTtRQUMvQixNQUFNLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUN0RSxDQUFDO0lBWWMsK0JBQWdCLEdBQS9CLFVBQWdDLElBQVksRUFBRSxRQUF5QjtRQUF6Qix5QkFBQSxFQUFBLGlCQUF5QjtRQUNuRSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLGVBQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLGVBQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdEMsQ0FBQztJQUNMLENBQUM7SUFDTCxxQkFBQztBQUFELENBQUMsQUF2R0Q7QUFxRm1CLHdCQUFTLEdBQUcsNGNBUU4sQ0FBQztBQTdGYix3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGF1dGhvciAgVMO8bWF5IMOHZWJlciA8dHVtYXljZWJlckBnbWFpbC5jb20+XG4gKiBAbGluayAgICBodHRwczovL2dpdGh1Yi5jb20vYnJlbmR0dW1pL2JrbWV4cHJlc3NcbiAqIEBsaWNlbnNlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqIEBkYXRlIDI2LjA0LjIwMTdcbiAqL1xuXG5pbXBvcnQge0J1ZmZlcn0gZnJvbSBcImJ1ZmZlclwiO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCAqIGFzIHNlbXZlciBmcm9tIFwic2VtdmVyXCI7XG5pbXBvcnQge1Zwb3NDb25maWd9IGZyb20gXCIuL3JlcXVlc3QvdnBvc0NvbmZpZ1wiO1xuY29uc3Qgbm9kZVZlcnNpb24gPSBzZW12ZXIuY2xlYW4ocHJvY2Vzcy52ZXJzaW9uKTtcbmltcG9ydCB7RW5jcnlwdGlvbkV4Y2VwdGlvbn0gZnJvbSBcIi4uL2V4Y2VwdGlvbnNcIjtcblxuZXhwb3J0IGNsYXNzIEVuY3J5cHRpb25VdGlsIHtcblxuICAgIHB1YmxpYyBzdGF0aWMgc2lnbihwcml2YXRlS2V5OiBzdHJpbmcsIGRhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzaWduID0gY3J5cHRvLmNyZWF0ZVNpZ24oXCJSU0EtU0hBMjU2XCIpO1xuICAgICAgICAgICAgc2lnbi51cGRhdGUoZGF0YSk7XG4gICAgICAgICAgICByZXR1cm4gc2lnbi5zaWduKHByaXZhdGVLZXksIFwiYmFzZTY0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVuY3J5cHRpb25FeGNlcHRpb24oZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyB2ZXJpZnkocHVibGljS2V5OiBzdHJpbmcsIGRhdGE6IHN0cmluZywgc2lnbmF0dXJlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHZlcmlmeSA9IGNyeXB0by5jcmVhdGVWZXJpZnkoXCJSU0EtU0hBMjU2XCIpO1xuICAgICAgICAgICAgdmVyaWZ5LnVwZGF0ZShkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiB2ZXJpZnkudmVyaWZ5KHB1YmxpY0tleSwgc2lnbmF0dXJlLCBcImJhc2U2NFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFbmNyeXB0aW9uRXhjZXB0aW9uKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZW5jcnlwdChwdWJsaWNLZXk6IHN0cmluZywgcGxhaW50ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGxhaW5CdWZmZXI6IEJ1ZmZlciA9IEVuY3J5cHRpb25VdGlsLmJ1ZmZlckZyb21TdHJpbmcocGxhaW50ZXh0KTtcbiAgICAgICAgICAgIGxldCBjcnlwdDogQnVmZmVyO1xuXG4gICAgICAgICAgICBpZiAoc2VtdmVyLmd0ZShub2RlVmVyc2lvbiwgXCIwLjExLjE0XCIpKSB7XG4gICAgICAgICAgICAgICAgY3J5cHQgPSBjcnlwdG8ucHVibGljRW5jcnlwdChwdWJsaWNLZXksIHBsYWluQnVmZmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IE5vZGVSU0EgPSByZXF1aXJlKFwibm9kZS1yc2FcIik7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gbmV3IE5vZGVSU0EocHVibGljS2V5KTtcbiAgICAgICAgICAgICAgICBjcnlwdCA9IGtleS5lbmNyeXB0KHBsYWluQnVmZmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjcnlwdC50b1N0cmluZyhcImJhc2U2NFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFbmNyeXB0aW9uRXhjZXB0aW9uKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZGVjcnlwdChwcml2YXRlS2V5OiBzdHJpbmcsIHBsYWludGV4dDogc3RyaW5nLCBpc0Jhc2U2NDogYm9vbGVhbiA9IGZhbHNlKTogc3RyaW5nIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHBsYWluQnVmZmVyOiBCdWZmZXIgPSBFbmNyeXB0aW9uVXRpbC5idWZmZXJGcm9tU3RyaW5nKHBsYWludGV4dCwgaXNCYXNlNjQgPyBcImJhc2U2NFwiIDogXCJ1dGY4XCIpO1xuICAgICAgICAgICAgbGV0IGNyeXB0OiBCdWZmZXI7XG5cbiAgICAgICAgICAgIGlmIChzZW12ZXIuZ3RlKG5vZGVWZXJzaW9uLCBcIjAuMTEuMTRcIikpIHtcbiAgICAgICAgICAgICAgICBjcnlwdCA9IGNyeXB0by5wcml2YXRlRGVjcnlwdChwcml2YXRlS2V5LCBwbGFpbkJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBOb2RlUlNBID0gcmVxdWlyZShcIm5vZGUtcnNhXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IG5ldyBOb2RlUlNBKHByaXZhdGVLZXkpO1xuICAgICAgICAgICAgICAgIGNyeXB0ID0ga2V5LmRlY3J5cHQocGxhaW5CdWZmZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNyeXB0LnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRW5jcnlwdGlvbkV4Y2VwdGlvbihlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIHZlcmlmeUJleFNpZ24oZGF0YTogc3RyaW5nLCBzaWduYXR1cmU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gRW5jcnlwdGlvblV0aWwudmVyaWZ5KEVuY3J5cHRpb25VdGlsLnB1YmxpY0tleSwgZGF0YSwgc2lnbmF0dXJlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGVuY3J5cHRXaXRoQmV4KHZwb3NDb25maWc6IFZwb3NDb25maWcgfCBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBpZiAodnBvc0NvbmZpZyBpbnN0YW5jZW9mIFZwb3NDb25maWcpIHtcbiAgICAgICAgICAgIHJldHVybiBFbmNyeXB0aW9uVXRpbC5lbmNyeXB0KEVuY3J5cHRpb25VdGlsLnB1YmxpY0tleSwgSlNPTi5zdHJpbmdpZnkodnBvc0NvbmZpZykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIEVuY3J5cHRpb25VdGlsLmVuY3J5cHQoRW5jcnlwdGlvblV0aWwucHVibGljS2V5LCB2cG9zQ29uZmlnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZW5jb2RlNjQoZGF0YTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIEVuY3J5cHRpb25VdGlsLmJ1ZmZlckZyb21TdHJpbmcoZGF0YSkudG9TdHJpbmcoXCJiYXNlNjRcIik7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBkZWNvZGU2NChkYXRhOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gRW5jcnlwdGlvblV0aWwuYnVmZmVyRnJvbVN0cmluZyhkYXRhLCBcImJhc2U2NFwiKS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIHB1YmxpY0tleSA9IGAtLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF1WmovVFE5WlJZNUtuc0EzSE1QcVxuYk53STMySitCaXN5djdLWDdJUkpoNXJONUxXM2c3dDZwdWxBckxJRVUzc24yOFpRRVErR0NiOXl2azZ6SVVvcVxuS0JxSDBIK2d2eE90c2tsT1VrRlJnaCsvRmdoTkRvZTBPemtYVExqUUtoaDZNUk1CUjlsM2N3czluQTJjdStNNVxua3c2N0Y4ajArNFNvZ0hKK1ZTMXdBMmtmV3g1OFBORElnOUR0QVZ3bUQxSmJqQXppUE9OdjB3SFNhOG9OZ2lhOVxuVHg2aWE2RlM0bmZqUk5xcFZxSTBtMmpJY0c4eVh0MU9hQlNhemt1UmxSZXBNdERWd01HRjR4T1dYdVJWditHNVxub2lUc2JPZXo5dFFBY3grS0gwVzFQbjlROS96ek9KeUY5QVM4SjFVREU3YzdyS3dYR0RudVRCVTFCd2RBR3lCOFxuN1FJREFRQUJcbi0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLWA7XG5cbiAgICBwcml2YXRlIHN0YXRpYyBidWZmZXJGcm9tU3RyaW5nKGRhdGE6IHN0cmluZywgZW5jb2Rpbmc6IHN0cmluZyA9IFwidXRmOFwiKTogQnVmZmVyIHtcbiAgICAgICAgaWYgKHNlbXZlci5ndGUobm9kZVZlcnNpb24sIFwiNi4wLjBcIikpIHtcbiAgICAgICAgICAgIHJldHVybiBCdWZmZXIuZnJvbShkYXRhLCBlbmNvZGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlcihkYXRhLCBlbmNvZGluZyk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=