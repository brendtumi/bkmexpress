"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var buffer_1 = require("buffer");
var crypto = require("crypto");
var semver = require("semver");
var vposConfig_1 = require("./request/vposConfig");
var nodeVersion = semver.clean(process.version);
var exceptions_1 = require("../exceptions");
var EncryptionUtil = (function () {
    function EncryptionUtil() {
    }
    EncryptionUtil.sign = function (privateKey, data) {
        try {
            var sign = crypto.createSign("RSA-SHA256");
            sign.update(data);
            return sign.sign(privateKey, "base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.verify = function (publicKey, data, signature) {
        try {
            var verify = crypto.createVerify("RSA-SHA256");
            verify.update(data);
            return verify.verify(publicKey, signature, "base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.encrypt = function (publicKey, plaintext) {
        try {
            var plainBuffer = EncryptionUtil.bufferFromString(plaintext);
            var crypt = void 0;
            if (semver.gte(nodeVersion, "0.11.14")) {
                crypt = crypto.publicEncrypt(publicKey, plainBuffer);
            }
            else {
                var NodeRSA = require("node-rsa");
                var key = new NodeRSA(publicKey);
                crypt = key.encrypt(plainBuffer);
            }
            return crypt.toString("base64");
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.decrypt = function (privateKey, plaintext, isBase64) {
        if (isBase64 === void 0) { isBase64 = false; }
        try {
            var plainBuffer = EncryptionUtil.bufferFromString(plaintext, isBase64 ? "base64" : "utf8");
            var crypt = void 0;
            if (semver.gte(nodeVersion, "0.11.14")) {
                crypt = crypto.privateDecrypt(privateKey, plainBuffer);
            }
            else {
                var NodeRSA = require("node-rsa");
                var key = new NodeRSA(privateKey);
                crypt = key.decrypt(plainBuffer);
            }
            return crypt.toString();
        }
        catch (error) {
            throw new exceptions_1.EncryptionException(error);
        }
    };
    EncryptionUtil.verifyBexSign = function (data, signature) {
        return EncryptionUtil.verify(EncryptionUtil.publicKey, data, signature);
    };
    EncryptionUtil.encryptWithBex = function (vposConfig) {
        if (vposConfig instanceof vposConfig_1.VposConfig) {
            return EncryptionUtil.encrypt(EncryptionUtil.publicKey, JSON.stringify(vposConfig));
        }
        else {
            return EncryptionUtil.encrypt(EncryptionUtil.publicKey, vposConfig);
        }
    };
    EncryptionUtil.encode64 = function (data) {
        return EncryptionUtil.bufferFromString(data).toString("base64");
    };
    EncryptionUtil.decode64 = function (data) {
        return EncryptionUtil.bufferFromString(data, "base64").toString();
    };
    EncryptionUtil.bufferFromString = function (data, encoding) {
        if (encoding === void 0) { encoding = "utf8"; }
        if (semver.gte(nodeVersion, "6.0.0")) {
            return buffer_1.Buffer.from(data, encoding);
        }
        else {
            return new buffer_1.Buffer(data, encoding);
        }
    };
    return EncryptionUtil;
}());
EncryptionUtil.publicKey = "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuZj/TQ9ZRY5KnsA3HMPq\nbNwI32J+Bisyv7KX7IRJh5rN5LW3g7t6pulArLIEU3sn28ZQEQ+GCb9yvk6zIUoq\nKBqH0H+gvxOtsklOUkFRgh+/FghNDoe0OzkXTLjQKhh6MRMBR9l3cws9nA2cu+M5\nkw67F8j0+4SogHJ+VS1wA2kfWx58PNDIg9DtAVwmD1JbjAziPONv0wHSa8oNgia9\nTx6ia6FS4nfjRNqpVqI0m2jIcG8yXt1OaBSazkuRlRepMtDVwMGF4xOWXuRVv+G5\noiTsbOez9tQAcx+KH0W1Pn9Q9/zzOJyF9AS8J1UDE7c7rKwXGDnuTBU1BwdAGyB8\n7QIDAQAB\n-----END PUBLIC KEY-----";
exports.EncryptionUtil = EncryptionUtil;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VjdXJpdHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWVyY2hhbnQvc2VjdXJpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFPQSxpQ0FBOEI7QUFDOUIsK0JBQWlDO0FBQ2pDLCtCQUFpQztBQUNqQyxtREFBZ0Q7QUFDaEQsSUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbEQsNENBQWtEO0FBRWxEO0lBQUE7SUF1R0EsQ0FBQztJQXJHaUIsbUJBQUksR0FBbEIsVUFBbUIsVUFBa0IsRUFBRSxJQUFZO1FBQy9DLElBQUksQ0FBQztZQUNELElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDM0MsQ0FBQztRQUNELEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDWCxNQUFNLElBQUksZ0NBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekMsQ0FBQztJQUNMLENBQUM7SUFFYSxxQkFBTSxHQUFwQixVQUFxQixTQUFpQixFQUFFLElBQVksRUFBRSxTQUFpQjtRQUNuRSxJQUFJLENBQUM7WUFDRCxJQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN6RCxDQUFDO1FBQ0QsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNYLE1BQU0sSUFBSSxn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RWEsdUJBQVEsR0FBdEIsVUFBdUIsSUFBWTtRQUMvQixNQUFNLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRWEsdUJBQVEsR0FBdEIsVUFBdUIsSUFBWTtRQUMvQixNQUFNLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUN0RSxDQUFDO0lBWWMsK0JBQWdCLEdBQS9CLFVBQWdDLElBQVksRUFBRSxRQUF5QjtRQUF6Qix5QkFBQSxFQUFBLGlCQUF5QjtRQUNuRSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLGVBQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLENBQUM7UUFDRCxJQUFJLENBQUMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLGVBQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdEMsQ0FBQztJQUNMLENBQUM7SUFDTCxxQkFBQztBQUFELENBQUMsQUF2R0Q7QUFxRm1CLHdCQUFTLEdBQUcsNGNBUU4sQ0FBQztBQTdGYix3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGF1dGhvciAgVMO8bWF5IMOHZWJlciA8dHVtYXljZWJlckBnbWFpbC5jb20+XG4gKiBAbGluayAgICBodHRwczovL2dpdGh1Yi5jb20vYnJlbmR0dW1pL2JrbWV4cHJlc3NcbiAqIEBsaWNlbnNlIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqIEBkYXRlIDI2LjA0LjIwMTdcbiAqL1xuXG5pbXBvcnQge0J1ZmZlcn0gZnJvbSBcImJ1ZmZlclwiO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCAqIGFzIHNlbXZlciBmcm9tIFwic2VtdmVyXCI7XG5pbXBvcnQge1Zwb3NDb25maWd9IGZyb20gXCIuL3JlcXVlc3QvdnBvc0NvbmZpZ1wiO1xuY29uc3Qgbm9kZVZlcnNpb24gPSBzZW12ZXIuY2xlYW4ocHJvY2Vzcy52ZXJzaW9uKTtcbmltcG9ydCB7RW5jcnlwdGlvbkV4Y2VwdGlvbn0gZnJvbSBcIi4uL2V4Y2VwdGlvbnNcIjtcblxuZXhwb3J0IGNsYXNzIEVuY3J5cHRpb25VdGlsIHtcblxuICAgIHB1YmxpYyBzdGF0aWMgc2lnbihwcml2YXRlS2V5OiBzdHJpbmcsIGRhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzaWduID0gY3J5cHRvLmNyZWF0ZVNpZ24oXCJSU0EtU0hBMjU2XCIpO1xuICAgICAgICAgICAgc2lnbi51cGRhdGUoZGF0YSk7XG4gICAgICAgICAgICByZXR1cm4gc2lnbi5zaWduKHByaXZhdGVLZXksIFwiYmFzZTY0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVuY3J5cHRpb25FeGNlcHRpb24oZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyB2ZXJpZnkocHVibGljS2V5OiBzdHJpbmcsIGRhdGE6IHN0cmluZywgc2lnbmF0dXJlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHZlcmlmeSA9IGNyeXB0by5jcmVhdGVWZXJpZnkoXCJSU0EtU0hBMjU2XCIpO1xuICAgICAgICAgICAgdmVyaWZ5LnVwZGF0ZShkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiB2ZXJpZnkudmVyaWZ5KHB1YmxpY0tleSwgc2lnbmF0dXJlLCBcImJhc2U2NFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFbmNyeXB0aW9uRXhjZXB0aW9uKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZW5jcnlwdChwdWJsaWNLZXk6IHN0cmluZywgcGxhaW50ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGxhaW5CdWZmZXI6IEJ1ZmZlciA9IEVuY3J5cHRpb25VdGlsLmJ1ZmZlckZyb21TdHJpbmcocGxhaW50ZXh0KTtcbiAgICAgICAgICAgIGxldCBjcnlwdDogQnVmZmVyO1xuXG4gICAgICAgICAgICBpZiAoc2VtdmVyLmd0ZShub2RlVmVyc2lvbiwgXCIwLjExLjE0XCIpKSB7XG4gICAgICAgICAgICAgICAgY3J5cHQgPSBjcnlwdG8ucHVibGljRW5jcnlwdChwdWJsaWNLZXksIHBsYWluQnVmZmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IE5vZGVSU0E6IGFueSA9IHJlcXVpcmUoXCJub2RlLXJzYVwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBrZXk6IGFueSA9IG5ldyBOb2RlUlNBKHB1YmxpY0tleSk7XG4gICAgICAgICAgICAgICAgY3J5cHQgPSBrZXkuZW5jcnlwdChwbGFpbkJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY3J5cHQudG9TdHJpbmcoXCJiYXNlNjRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRW5jcnlwdGlvbkV4Y2VwdGlvbihlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRlY3J5cHQocHJpdmF0ZUtleTogc3RyaW5nLCBwbGFpbnRleHQ6IHN0cmluZywgaXNCYXNlNjQ6IGJvb2xlYW4gPSBmYWxzZSk6IHN0cmluZyB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwbGFpbkJ1ZmZlcjogQnVmZmVyID0gRW5jcnlwdGlvblV0aWwuYnVmZmVyRnJvbVN0cmluZyhwbGFpbnRleHQsIGlzQmFzZTY0ID8gXCJiYXNlNjRcIiA6IFwidXRmOFwiKTtcbiAgICAgICAgICAgIGxldCBjcnlwdDogQnVmZmVyO1xuXG4gICAgICAgICAgICBpZiAoc2VtdmVyLmd0ZShub2RlVmVyc2lvbiwgXCIwLjExLjE0XCIpKSB7XG4gICAgICAgICAgICAgICAgY3J5cHQgPSBjcnlwdG8ucHJpdmF0ZURlY3J5cHQocHJpdmF0ZUtleSwgcGxhaW5CdWZmZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgTm9kZVJTQTogYW55ID0gcmVxdWlyZShcIm5vZGUtcnNhXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGtleTogYW55ID0gbmV3IE5vZGVSU0EocHJpdmF0ZUtleSk7XG4gICAgICAgICAgICAgICAgY3J5cHQgPSBrZXkuZGVjcnlwdChwbGFpbkJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY3J5cHQudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFbmNyeXB0aW9uRXhjZXB0aW9uKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgdmVyaWZ5QmV4U2lnbihkYXRhOiBzdHJpbmcsIHNpZ25hdHVyZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBFbmNyeXB0aW9uVXRpbC52ZXJpZnkoRW5jcnlwdGlvblV0aWwucHVibGljS2V5LCBkYXRhLCBzaWduYXR1cmUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZW5jcnlwdFdpdGhCZXgodnBvc0NvbmZpZzogVnBvc0NvbmZpZyB8IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGlmICh2cG9zQ29uZmlnIGluc3RhbmNlb2YgVnBvc0NvbmZpZykge1xuICAgICAgICAgICAgcmV0dXJuIEVuY3J5cHRpb25VdGlsLmVuY3J5cHQoRW5jcnlwdGlvblV0aWwucHVibGljS2V5LCBKU09OLnN0cmluZ2lmeSh2cG9zQ29uZmlnKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gRW5jcnlwdGlvblV0aWwuZW5jcnlwdChFbmNyeXB0aW9uVXRpbC5wdWJsaWNLZXksIHZwb3NDb25maWcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBlbmNvZGU2NChkYXRhOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gRW5jcnlwdGlvblV0aWwuYnVmZmVyRnJvbVN0cmluZyhkYXRhKS50b1N0cmluZyhcImJhc2U2NFwiKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGRlY29kZTY0KGRhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBFbmNyeXB0aW9uVXRpbC5idWZmZXJGcm9tU3RyaW5nKGRhdGEsIFwiYmFzZTY0XCIpLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgcHVibGljS2V5ID0gYC0tLS0tQkVHSU4gUFVCTElDIEtFWS0tLS0tXG5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXVaai9UUTlaUlk1S25zQTNITVBxXG5iTndJMzJKK0Jpc3l2N0tYN0lSSmg1ck41TFczZzd0NnB1bEFyTElFVTNzbjI4WlFFUStHQ2I5eXZrNnpJVW9xXG5LQnFIMEgrZ3Z4T3Rza2xPVWtGUmdoKy9GZ2hORG9lME96a1hUTGpRS2hoNk1STUJSOWwzY3dzOW5BMmN1K001XG5rdzY3RjhqMCs0U29nSEorVlMxd0Eya2ZXeDU4UE5ESWc5RHRBVndtRDFKYmpBemlQT052MHdIU2E4b05naWE5XG5UeDZpYTZGUzRuZmpSTnFwVnFJMG0yakljRzh5WHQxT2FCU2F6a3VSbFJlcE10RFZ3TUdGNHhPV1h1UlZ2K0c1XG5vaVRzYk9lejl0UUFjeCtLSDBXMVBuOVE5L3p6T0p5RjlBUzhKMVVERTdjN3JLd1hHRG51VEJVMUJ3ZEFHeUI4XG43UUlEQVFBQlxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tYDtcblxuICAgIHByaXZhdGUgc3RhdGljIGJ1ZmZlckZyb21TdHJpbmcoZGF0YTogc3RyaW5nLCBlbmNvZGluZzogc3RyaW5nID0gXCJ1dGY4XCIpOiBCdWZmZXIge1xuICAgICAgICBpZiAoc2VtdmVyLmd0ZShub2RlVmVyc2lvbiwgXCI2LjAuMFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKGRhdGEsIGVuY29kaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQnVmZmVyKGRhdGEsIGVuY29kaW5nKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==