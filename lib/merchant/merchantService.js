"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Bluebird = require("bluebird");
var exceptions_1 = require("../exceptions");
var merchantApi_1 = require("./merchantApi");
var security_1 = require("./security");
var merchantLoginRequest_1 = require("./request/merchantLoginRequest");
var MerchantService = (function () {
    function MerchantService(configuration) {
        this.configuration = configuration;
    }
    MerchantService.prototype.login = function () {
        var _this = this;
        var merchantId = this.configuration.MerchantId;
        var sign = security_1.EncryptionUtil.sign(this.configuration.MerchantPrivateKey, merchantId);
        var request = new merchantLoginRequest_1.MerchantLoginRequest(merchantId, sign);
        return new Bluebird(function (resolve, reject) {
            merchantApi_1.MerchantApi.login(_this.configuration.BexApiConfiguration.BaseUrl, request)
                .then(function (response) {
                resolve(response.Token);
            })
                .catch(function (error) {
                reject(new exceptions_1.MerchantServiceException(error));
            });
        });
    };
    return MerchantService;
}());
exports.MerchantService = MerchantService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVyY2hhbnRTZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21lcmNoYW50L21lcmNoYW50U2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQU9BLG1DQUFxQztBQUVyQyw0Q0FBdUQ7QUFDdkQsNkNBQTBDO0FBRTFDLHVDQUEwQztBQUMxQyx1RUFBb0U7QUFHcEU7SUFHSSx5QkFBbUIsYUFBNEI7UUFDM0MsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7SUFDdkMsQ0FBQztJQUVNLCtCQUFLLEdBQVo7UUFBQSxpQkFhQztRQVpHLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDO1FBQ2pELElBQU0sSUFBSSxHQUFHLHlCQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDcEYsSUFBTSxPQUFPLEdBQUcsSUFBSSwyQ0FBb0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDM0QsTUFBTSxDQUFDLElBQUksUUFBUSxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDaEMseUJBQVcsQ0FBQyxLQUFLLENBQUMsS0FBSSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDO2lCQUNyRSxJQUFJLENBQUMsVUFBQyxRQUErQjtnQkFDbEMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLFVBQUMsS0FBSztnQkFDVCxNQUFNLENBQUMsSUFBSSxxQ0FBd0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2hELENBQUMsQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUwsc0JBQUM7QUFBRCxDQUFDLEFBdEJELElBc0JDO0FBdEJZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAYXV0aG9yICBUw7xtYXkgw4dlYmVyIDx0dW1heWNlYmVyQGdtYWlsLmNvbT5cbiAqIEBsaW5rICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9icmVuZHR1bWkvYmttZXhwcmVzc1xuICogQGxpY2Vuc2UgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICogQGRhdGUgMjguMDQuMjAxN1xuICovXG5cbmltcG9ydCAqIGFzIEJsdWViaXJkIGZyb20gXCJibHVlYmlyZFwiO1xuaW1wb3J0IHtDb25maWd1cmF0aW9ufSBmcm9tIFwiLi4vY29uZmlnL2NvbmZpZ3VyYXRpb25cIjtcbmltcG9ydCB7TWVyY2hhbnRTZXJ2aWNlRXhjZXB0aW9ufSBmcm9tIFwiLi4vZXhjZXB0aW9uc1wiO1xuaW1wb3J0IHtNZXJjaGFudEFwaX0gZnJvbSBcIi4vbWVyY2hhbnRBcGlcIjtcbmltcG9ydCB7VG9rZW59IGZyb20gXCIuL3Rva2VuXCI7XG5pbXBvcnQge0VuY3J5cHRpb25VdGlsfSBmcm9tIFwiLi9zZWN1cml0eVwiO1xuaW1wb3J0IHtNZXJjaGFudExvZ2luUmVxdWVzdH0gZnJvbSBcIi4vcmVxdWVzdC9tZXJjaGFudExvZ2luUmVxdWVzdFwiO1xuaW1wb3J0IHtNZXJjaGFudExvZ2luUmVzcG9uc2V9IGZyb20gXCIuL3Jlc3BvbnNlL21lcmNoYW50TG9naW5SZXNwb25zZVwiO1xuXG5leHBvcnQgY2xhc3MgTWVyY2hhbnRTZXJ2aWNlIHtcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJhdGlvbjogQ29uZmlndXJhdGlvbjtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihjb25maWd1cmF0aW9uOiBDb25maWd1cmF0aW9uKSB7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247XG4gICAgfVxuXG4gICAgcHVibGljIGxvZ2luKCk6IFByb21pc2U8VG9rZW4gfCBNZXJjaGFudFNlcnZpY2VFeGNlcHRpb24+IHtcbiAgICAgICAgY29uc3QgbWVyY2hhbnRJZCA9IHRoaXMuY29uZmlndXJhdGlvbi5NZXJjaGFudElkO1xuICAgICAgICBjb25zdCBzaWduID0gRW5jcnlwdGlvblV0aWwuc2lnbih0aGlzLmNvbmZpZ3VyYXRpb24uTWVyY2hhbnRQcml2YXRlS2V5LCBtZXJjaGFudElkKTtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IG5ldyBNZXJjaGFudExvZ2luUmVxdWVzdChtZXJjaGFudElkLCBzaWduKTtcbiAgICAgICAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBNZXJjaGFudEFwaS5sb2dpbih0aGlzLmNvbmZpZ3VyYXRpb24uQmV4QXBpQ29uZmlndXJhdGlvbi5CYXNlVXJsLCByZXF1ZXN0KVxuICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZTogTWVyY2hhbnRMb2dpblJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UuVG9rZW4pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IE1lcmNoYW50U2VydmljZUV4Y2VwdGlvbihlcnJvcikpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn1cbiJdfQ==